<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeyondChats RAG System Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 400px;
        }
        .log-entry {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        .log-info { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        .log-success { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
        .log-error { background-color: #ffebee; border-left: 4px solid #f44336; }
        .log-warning { background-color: #fff3e0; border-left: 4px solid #ff9800; }
        .log-test { background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-bar {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .test-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .api-config {
            margin-bottom: 15px;
        }
        
        .api-config input {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        .health-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .health-excellent { background-color: #4caf50; }
        .health-good { background-color: #8bc34a; }
        .health-fair { background-color: #ff9800; }
        .health-poor { background-color: #f44336; }
        
        .endpoint-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .endpoint-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .endpoint-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .endpoint-status {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß† BeyondChats RAG System Test Suite</h1>
        <p>Comprehensive testing for Retrieval-Augmented Generation workflow</p>
    </div>

    <div class="test-controls">
        <h3>Test Configuration</h3>
        <div class="api-config">
            <label for="apiBase">API Base URL:</label>
            <input type="text" id="apiBase" value="http://localhost:3000/api" placeholder="API Base URL">
        </div>
        
        <button class="btn" onclick="runAllTests()">üöÄ Run All Tests</button>
        <button class="btn" onclick="runSearchTests()">üîç Test Search Only</button>
        <button class="btn" onclick="runChatTests()">üí¨ Test Chat Only</button>
        <button class="btn" onclick="runPerformanceTests()">‚ö° Test Performance</button>
        <button class="btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
    </div>

    <div class="status-bar">
        <div>
            <span id="testStatus">Ready to run tests</span>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        <div id="healthIndicator">
            <span class="health-indicator health-excellent"></span>
            <span>System Status</span>
        </div>
    </div>

    <div class="test-summary" id="testSummary" style="display: none;">
        <div class="summary-card">
            <div class="summary-number" id="totalTests">0</div>
            <div class="summary-label">Total Tests</div>
        </div>
        <div class="summary-card">
            <div class="summary-number" id="passedTests" style="color: #4caf50;">0</div>
            <div class="summary-label">Passed</div>
        </div>
        <div class="summary-card">
            <div class="summary-number" id="failedTests" style="color: #f44336;">0</div>
            <div class="summary-label">Failed</div>
        </div>
        <div class="summary-card">
            <div class="summary-number" id="successRate">0%</div>
            <div class="summary-label">Success Rate</div>
        </div>
    </div>

    <div class="endpoint-tests" id="endpointStatus" style="display: none;">
        <div class="endpoint-card">
            <div class="endpoint-title">üîç Search Endpoint</div>
            <div class="endpoint-status" id="searchStatus">
                <span class="health-indicator"></span>
                <span>Not tested</span>
            </div>
        </div>
        <div class="endpoint-card">
            <div class="endpoint-title">üí¨ Chat Endpoint</div>
            <div class="endpoint-status" id="chatStatus">
                <span class="health-indicator"></span>
                <span>Not tested</span>
            </div>
        </div>
        <div class="endpoint-card">
            <div class="endpoint-title">‚ö†Ô∏è Error Handling</div>
            <div class="endpoint-status" id="errorStatus">
                <span class="health-indicator"></span>
                <span>Not tested</span>
            </div>
        </div>
        <div class="endpoint-card">
            <div class="endpoint-title">‚ö° Performance</div>
            <div class="endpoint-status" id="performanceStatus">
                <span class="health-indicator"></span>
                <span>Not tested</span>
            </div>
        </div>
    </div>

    <div class="test-results">
        <h3>Test Results</h3>
        <div id="logContainer">
            <div class="log-entry log-info">
                üìã Ready to start testing. Click "Run All Tests" to begin comprehensive testing.
            </div>
        </div>
    </div>

    <script src="rag-test-suite.js"></script>
    <script>
        let currentTestSuite = null;
        let isRunning = false;

        // Custom logger for HTML output
        class HTMLLogger {
            constructor(container) {
                this.container = container;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toISOString().substr(11, 8);
                const prefix = {
                    info: 'üìã',
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    test: 'üß™'
                }[type] || 'üìã';

                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.innerHTML = `${prefix} [${timestamp}] ${message}`;
                
                this.container.appendChild(logEntry);
                this.container.scrollTop = this.container.scrollHeight;
            }
        }

        // Enhanced test suite for HTML
        class HTMLRAGTestSuite extends RAGTestSuite {
            constructor(apiBase, logger) {
                super(apiBase);
                this.logger = logger;
                this.currentTest = 0;
                this.totalTestCount = 0;
            }

            log(message, type = 'info') {
                this.logger.log(message, type);
                super.log(message, type);
            }

            updateProgress() {
                if (this.totalTestCount > 0) {
                    const progress = (this.currentTest / this.totalTestCount) * 100;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                    document.getElementById('testStatus').textContent = 
                        `Running tests... ${this.currentTest}/${this.totalTestCount}`;
                }
            }

            updateEndpointStatus(endpoint, status, message) {
                const statusElement = document.getElementById(`${endpoint}Status`);
                if (statusElement) {
                    const indicator = statusElement.querySelector('.health-indicator');
                    const text = statusElement.querySelector('span:last-child');
                    
                    indicator.className = `health-indicator health-${status}`;
                    text.textContent = message;
                }
            }

            async testSearchBasic() {
                this.updateEndpointStatus('search', 'fair', 'Testing...');
                const result = await super.testSearchBasic();
                this.updateEndpointStatus('search', result ? 'excellent' : 'poor', 
                    result ? 'All tests passed' : 'Some tests failed');
                this.currentTest++;
                this.updateProgress();
                return result;
            }

            async testChatRAG() {
                this.updateEndpointStatus('chat', 'fair', 'Testing...');
                const result = await super.testChatRAG();
                this.updateEndpointStatus('chat', result ? 'excellent' : 'poor', 
                    result ? 'RAG working correctly' : 'Issues detected');
                this.currentTest++;
                this.updateProgress();
                return result;
            }

            async testErrorHandling() {
                this.updateEndpointStatus('error', 'fair', 'Testing...');
                const result = await super.testErrorHandling();
                this.updateEndpointStatus('error', result ? 'excellent' : 'poor', 
                    result ? 'Proper error handling' : 'Error handling issues');
                this.currentTest++;
                this.updateProgress();
                return result;
            }

            async testPerformance() {
                this.updateEndpointStatus('performance', 'fair', 'Testing...');
                const result = await super.testPerformance();
                this.updateEndpointStatus('performance', result ? 'excellent' : 'poor', 
                    result ? 'Good performance' : 'Performance issues');
                this.currentTest++;
                this.updateProgress();
                return result;
            }

            generateReport() {
                const summary = super.generateReport();
                
                // Update HTML summary
                document.getElementById('totalTests').textContent = summary.totalTests;
                document.getElementById('passedTests').textContent = summary.passedTests;
                document.getElementById('failedTests').textContent = summary.failedTests;
                document.getElementById('successRate').textContent = `${summary.successRate}%`;
                
                document.getElementById('testSummary').style.display = 'grid';
                document.getElementById('endpointStatus').style.display = 'grid';
                
                // Update health indicator
                const healthIndicator = document.getElementById('healthIndicator');
                const indicator = healthIndicator.querySelector('.health-indicator');
                const text = healthIndicator.querySelector('span:last-child');
                
                const healthClass = summary.successRate >= 90 ? 'excellent' :
                    summary.successRate >= 75 ? 'good' :
                    summary.successRate >= 50 ? 'fair' : 'poor';
                
                indicator.className = `health-indicator health-${healthClass}`;
                text.textContent = `${summary.successRate}% Success Rate`;
                
                document.getElementById('testStatus').textContent = 'Tests completed';
                document.getElementById('progressFill').style.width = '100%';
                
                return summary;
            }

            async runAllTests() {
                this.totalTestCount = 4; // Number of test suites
                this.currentTest = 0;
                return await super.runAllTests();
            }
        }

        // Test execution functions
        async function runAllTests() {
            if (isRunning) return;
            
            setRunning(true);
            clearResults();
            
            const apiBase = document.getElementById('apiBase').value;
            const logger = new HTMLLogger(document.getElementById('logContainer'));
            currentTestSuite = new HTMLRAGTestSuite(apiBase, logger);
            
            try {
                await currentTestSuite.runAllTests();
            } catch (error) {
                logger.log(`Test suite crashed: ${error.message}`, 'error');
            } finally {
                setRunning(false);
            }
        }

        async function runSearchTests() {
            if (isRunning) return;
            
            setRunning(true);
            const apiBase = document.getElementById('apiBase').value;
            const logger = new HTMLLogger(document.getElementById('logContainer'));
            currentTestSuite = new HTMLRAGTestSuite(apiBase, logger);
            
            try {
                await currentTestSuite.testSearchBasic();
                currentTestSuite.generateReport();
            } finally {
                setRunning(false);
            }
        }

        async function runChatTests() {
            if (isRunning) return;
            
            setRunning(true);
            const apiBase = document.getElementById('apiBase').value;
            const logger = new HTMLLogger(document.getElementById('logContainer'));
            currentTestSuite = new HTMLRAGTestSuite(apiBase, logger);
            
            try {
                await currentTestSuite.testChatRAG();
                currentTestSuite.generateReport();
            } finally {
                setRunning(false);
            }
        }

        async function runPerformanceTests() {
            if (isRunning) return;
            
            setRunning(true);
            const apiBase = document.getElementById('apiBase').value;
            const logger = new HTMLLogger(document.getElementById('logContainer'));
            currentTestSuite = new HTMLRAGTestSuite(apiBase, logger);
            
            try {
                await currentTestSuite.testPerformance();
                currentTestSuite.generateReport();
            } finally {
                setRunning(false);
            }
        }

        function clearResults() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div class="log-entry log-info">üìã Ready to start testing.</div>';
            
            document.getElementById('testSummary').style.display = 'none';
            document.getElementById('endpointStatus').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('testStatus').textContent = 'Ready to run tests';
        }

        function setRunning(running) {
            isRunning = running;
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                if (btn.onclick && btn.textContent.includes('Clear')) return;
                btn.disabled = running;
            });
        }

        // Auto-run if URL parameter is set
        if (window.location.search.includes('autorun=true')) {
            setTimeout(runAllTests, 1000);
        }
    </script>
</body>
</html>